# N8N-R8 Log Rotation Configuration
# This file configures log rotation for all N8N-R8 services

# Global settings
compress
delaycompress
missingok
notifempty
create 644 root root

# N8N application logs
/home/ram/projects/n8n-r8/monitoring/logs/*.log {
    daily
    rotate 7
    size 10M
    compress
    delaycompress
    missingok
    notifempty
    create 644 ram ram
    postrotate
        # Restart monitoring if running
        if [ -f /home/ram/projects/n8n-r8/monitoring/logs/monitor.pid ]; then
            kill -USR1 $(cat /home/ram/projects/n8n-r8/monitoring/logs/monitor.pid) 2>/dev/null || true
        fi
    endscript
}

# Docker container logs (if using json-file driver)
/var/lib/docker/containers/*/*-json.log {
    daily
    rotate 5
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}

# Nginx logs (if using nginx proxy)
/var/log/nginx/*.log {
    daily
    rotate 14
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    create 644 www-data www-data
    prerotate
        if [ -d /etc/logrotate.d/httpd-prerotate ]; then \
            run-parts /etc/logrotate.d/httpd-prerotate; \
        fi
    endscript
    postrotate
        # Reload nginx if running
        docker exec n8n-nginx nginx -s reload 2>/dev/null || true
    endscript
}

# Traefik logs (if using traefik proxy)
/home/ram/projects/n8n-r8/traefik/logs/*.log {
    daily
    rotate 14
    size 50M
    compress
    delaycompress
    missingok
    notifempty
    create 644 ram ram
    postrotate
        # Send USR1 signal to traefik for log rotation
        docker exec n8n-traefik kill -USR1 1 2>/dev/null || true
    endscript
}

# System logs related to Docker
/var/log/docker.log {
    weekly
    rotate 4
    size 100M
    compress
    delaycompress
    missingok
    notifempty
    copytruncate
}
